#kcn服务器端api文档

###v1.0 by aghost

------------------------------

##关于接口url

接口url将在上线后给出

---------------------------------

##字符编码

所有接口的字符编码都为utf-8

-----------------------

##全局错误代码

- 0：无错误
- 10001：授权码无效（包括授权码过期）
- 10002：匿名用户信息验证失败
- 10003：用户登陆失败
- 10004：参数错误
- 10005：信息不存在
- 10006：匿名用户无此权限
- 10007：权限错误
- 10008：您已经评论过 
- 10009：在点赞前请取消砸鸡蛋（或者砸鸡蛋前取消点赞）
- 10010：tag超长
- 10011：tag数目已满
- 10012：验证码错误
- 10013：用户名已经被占用
- 10014：系统错误

----------------------------

##返回值json结构

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
| flag   | 操作是否成功  |   bool  |    |     |
| errcode   | 错误代码      |   int  |  错误代码见错误代码说明  |     |
| content   | 返回值主体      |   json  | 当flag为false时无此项   |     |


----------
#登陆授权

----------

##获取验证码

地址：/index.php/api/user/verifycode
请求方式：GET

###返回值
图片
  
获取授权码需要保存cookie


----------

##用户注册

地址：/index.php/api/user/reg
请求方式：POST

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|user|用户名|String|
|passwd|密码|String|发送sha1加密后的密码|
|email|邮箱|String|
|check|验证码|String|



###返回值
无content



----------

##查看用户名是否被占用接口

地址：/index.php/api/user/checkname
请求方式：GET

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|user|用户名|String|



###返回值
无content

----------


##匿名用户获取授权码（https）

地址：/index.php/api/user/anonymous
请求方式：POST

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|guestinfo|客户端信息|String|必须，主机名、系统类型、系统架构、操作系统版本号，以上信息均以半角括号括起，然后将其连接起来|os.hostname() os.type() os.arch() os.release()|
|secret|加密验证|String|将guestinfo中的几条数据以salt连接，计算sha1|主机名salt系统类型salt…………|
|check|验证码|String|

salt待定

###返回值

返回值为content中的json

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|授权码|String|用于授权认证||

授权码有效期为最后一次操作后的48小时

----------

##注册用户获取授权码（https）

地址：/index.php/api/user/login
请求方式：POST

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|user|用户名|String|
|passwd|密码|String|发送的是经过sha1加密的密码|
|guestinfo|客户端信息|String|必须，主机名、系统类型、系统架构、操作系统版本号，以上信息均以半角括号括起，然后将其连接起来|os.hostname() os.type() os.arch() os.release()|
|check|验证码|String|

###返回值

返回值为content中的json

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|授权码|String|用于授权认证||

授权码有效期为最后一次操作后的48小时


----------
#掉落相关 
----------
##上传掉落信息接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|授权码|String|
|time|掉落时间|datetime|2015-5-5 00:00:00|
|place|地图|String|5-4 1-1|
|point|掉落点|int|
|shipid|掉落|int|掉落船id|
|shiptype|舰船类型|int|
|rank|战斗评级|String|S A B C D E|

###返回值

无content，失败则5秒钟后重试

----------
##获取地图掉落接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String| 　
|place  |地图|  String| 5-4 1-1|

###返回值

返回值为一个有序的json数组，每个数组为一个json，json结构如下

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|point| 地点  |int| 　
|ships| 掉落  |json数组|  下标为舰船类型，内容为舰船名，以空格分隔|



----------
#配置相关

----------
##上传配置信息接口
| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String| 　
|time|  时间| datetime| 2015-5-5 00:00:00
|place| 地图| String| 5-4 1-1
|tags|  配置标签| String| 半角逗号分隔 tag1,tag2,tag3 方便搜索与分类；tag一般是‘小船流’、‘低消耗’、‘一路看脸’之类的短串，最多10个tag，每个tag最长25个字符（中文字符只算一个）|
|addtag|是否允许其他注册用户添加tag|int|0：不允许 1：允许
|info|  配置说明| String| 
|content| 配置| String| 将json用base64编码后整体发送

###返回值

无content，失败则5秒钟后重试


----------
##获取配置列表接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String| 　
|place| 地图| String| 5-4 1-1|
|sort|  排序方式| int|  1：按照时间降序 2：按照点赞数降序 3：按照砸鸡蛋数降序|
|page|页数|int|分页为10条，页码从1开始|
|tag|标签|String|非必须。按照标签匹配，请勿让用户输入，标签做的全字匹配|

###返回值

返回值为一个有序的json数组，每个数组为一个json，json结构如下

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|id|配置id| int|
|info|配置说明|String
|time|时间|datetime|2015-5-5 00:00:00
|fav|点赞数| int |
|dislike|砸鸡蛋数|int|
|tag|标签|String|以半角逗号隔开

 
 
----------

##获取自己上传的配置列表接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String| 　 
|sort|  排序方式| int|  1：按照时间降序 2：按照点赞数降序 3：按照砸鸡蛋数降序|  

###返回值

返回值为一个有序的json数组，每个数组为一个json，json结构如下

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|id|  配置id| int 　
|info|  配置说明| String  　
|time|  时间| datetime| 2015-5-5 00:00:00
|fav| 点赞数|  int 　
|dislike|砸鸡蛋数|int
|tag|标签|String|以半角逗号隔开

 

----------
##获取对应配置列表总数接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String| 　
|place| 地图| String| 5-4 1-1|
|tag|标签|String|非必须。按照标签匹配，请勿让用户输入，标签做的全字匹配|

###返回值

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|count|列表配置总条数|int|用于配置列表分页，当搜索信息改变时请重新获取


----------
##获取配置接口
| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String|
|id|  配置id| int|

###返回值

返回值为一个json

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|id|配置id| int|  
|info|配置说明| String  |
|time|时间| datetime  |2015-5-5 00:00:00|
|fav|点赞数| int |
|config|配置详情| json| 已解码|
|place|地图|String  |5-4 1-1|
|dislike|砸鸡蛋数|int|
 
----------
##点赞接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|授权码|  String|
|id|配置id| int| 


 

----------
##砸鸡蛋接口
| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String|
|id|  配置id| int|


----------
##添加tag接口
| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String|
|id|  配置id| int|
|tag|标签|String|只有一个标签，不能包含半角逗号


----------
##删除tag接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String|
|id|  配置id| int|
|tag|标签|String|只有一个标签，不能包含半角逗号


----------
##删除配置接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String|
|id|  配置id| int|





----------
#敌人配置相关

----------
##上传敌人信息接口


| 参数      | 参数说明      | 类型      | 备注 | 参考      |
|-----------|---------------|-----------|------|-----------|
| id        | 敌人舰队id    | int       |      |           |
| detail    | 敌方详情      | json      |      |           |
| map       | 地图          | string    |      | 3-2       |
| point     | 地图点        | int       |      | 1         |

###返回值

无content，失败则5秒钟后重试。
收到上传的敌人信息后，检查该配置是否在服务端配置中存在。若不存在，将其加入服务器端配置，并将服务器端敌人配置版本号加一。存储时每条配置有一个version字段，记录该条配置是在哪一个配置版本中加入的。




----------
##获取敌人信息接口


| 参数    | 参数说明           | 类型      | 备注 | 参考      |
|---------|--------------------|-----------|------|-----------|
| version | 客户端敌人配置版本 | int       |      |           |

###返回值

返回所有version字段大于客户端配置版本的敌人配置。

| 参数    | 参数说明           | 类型      | 备注 | 参考      |
|---------|--------------------|-----------|------|------     |
| version | 服务端敌人配置版本 | int       |
| enemy   | 新增的敌人舰队     | json      |      | [{配置详情}]


----------
#紫菜统计


---------- 
##上传资材接口

| 参数 | 参数说明 | 类型 | 备注 | 参考 |
| --- |:-------:|:----:|:---:|:----:|
|code|  授权码|  String
|oil| 油 |int
|ammo|  弹药| int
|steel| 钢 |int
|al|  铝 |int
|material|  紫菜| int
|fire|  火 |int
|bucket|  桶|  int
|screw| 螺丝| int

每次回港上传，不上传匿名用户